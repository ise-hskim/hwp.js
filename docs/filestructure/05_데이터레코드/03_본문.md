# 본문 레코드

BodyText 스트림에 포함되는 주요 레코드들에 대한 설명입니다.

## 문단 구조

본문은 문단(Paragraph)의 연속으로 구성되며, 각 문단은 다음 레코드들을 포함합니다:

1. HWPTAG_PARA_HEADER - 문단 헤더
2. HWPTAG_PARA_TEXT - 문단 텍스트
3. HWPTAG_PARA_CHAR_SHAPE - 글자 모양 정보
4. HWPTAG_PARA_LINE_SEG - 줄 나눔 정보
5. HWPTAG_PARA_RANGE_TAG - 영역 태그 (선택적)
6. HWPTAG_CTRL_HEADER - 컨트롤 객체 (선택적)

## HWPTAG_PARA_HEADER (0x42)

문단의 헤더 정보입니다.

```
struct ParaHeader {
    DWORD text;             // 텍스트 속성
    DWORD controlMask;      // 컨트롤 마스크
    WORD paraShapeId;       // 문단 모양 ID
    BYTE styleId;           // 스타일 ID
    BYTE divideSort;        // 단 나누기 종류
    WORD charShapeCount;    // 글자 모양 정보 수
    WORD rangeTagCount;     // 영역 태그 정보 수
    WORD lineAlignCount;    // 정렬 정보 수
    DWORD instanceId;       // 문단 인스턴스 ID
    
    // 5.0.3.2 이상
    WORD changeTrackingMerge; // 변경 추적 병합
}
```

### Text 필드 비트 구성
- bit 0: 마지막 문단 여부
- bit 1: 글자 모양 정보 포함
- bit 2: 정렬 정보 포함
- bit 3: 인스턴스 ID 포함
- bit 4-6: 미사용
- bit 7: 변경 추적 병합 포함
- bit 8-15: 미사용
- bit 16-31: 미사용

### ControlMask 비트 구성
각 비트는 해당 컨트롤의 존재 여부를 나타냅니다:
- bit 0: 예약
- bit 1: 예약
- bit 2: 구역 정의
- bit 3: 필드 시작
- bit 4: 필드 끝
- bit 5: 예약
- bit 6: 예약
- bit 7: 예약
- bit 8: 제목
- bit 9: 예약
- bit 10: 예약
- bit 11: 표/그리기 객체
- bit 12: 예약
- bit 13: 예약
- bit 14: 예약
- bit 15: 숨은 설명
- bit 16: 머리말/꼬리말
- bit 17: 각주/미주
- bit 18: 자동 번호
- bit 19: 예약
- bit 20: 예약
- bit 21: 쪽 번호/제어
- bit 22: 책갈피/찾아보기
- bit 23: 덧말/글상자
- bit 24-31: 예약

## HWPTAG_PARA_TEXT (0x43)

문단의 텍스트 내용입니다.

```
struct ParaText {
    WCHAR text[];           // UTF-16 LE 텍스트
}
```

### 특수 문자 코드
| 코드 | 의미 |
|------|------|
| 0x0000 | 예약 |
| 0x0001 | 예약 |
| 0x0002 | 구역 정의 |
| 0x0003 | 필드 시작 |
| 0x0004 | 필드 끝 |
| 0x0008 | 제목 |
| 0x0009 | 탭 |
| 0x000A | 강제 줄 나눔 |
| 0x000B | 그리기 객체/표 |
| 0x000D | 문단 끝 |
| 0x0018 | 하이픈 |
| 0x001E | 묶음 빈칸 |
| 0x001F | 고정폭 빈칸 |

## HWPTAG_PARA_CHAR_SHAPE (0x44)

문단 내 글자 모양 정보입니다.

```
struct ParaCharShape {
    struct CharShapeInfo {
        DWORD position;     // 적용 시작 위치
        WORD charShapeId;   // 글자 모양 ID
    } charShapes[];
}
```

## HWPTAG_PARA_LINE_SEG (0x45)

문단의 줄 나눔 정보입니다.

```
struct ParaLineSeg {
    struct LineSegInfo {
        DWORD textStart;    // 텍스트 시작 위치
        INT32 lineHeight;   // 줄 높이
        INT32 textHeight;   // 텍스트 높이
        INT32 baseLineGap;  // 베이스라인 간격
        INT32 lineSpacing;  // 줄 간격
        INT32 startX;       // 시작 X 좌표
        INT32 width;        // 줄 너비
        WORD tagValue;      // 태그 값
    } lineSegs[];
}
```

## HWPTAG_PARA_RANGE_TAG (0x46)

문단 내 영역 태그 정보입니다.

```
struct ParaRangeTag {
    struct RangeTagInfo {
        DWORD startPos;     // 시작 위치
        DWORD endPos;       // 끝 위치
        BYTE tagData[12];   // 태그 데이터
    } rangeTags[];
}
```

## HWPTAG_CTRL_HEADER (0x47)

컨트롤 객체의 헤더입니다.

```
struct CtrlHeader {
    DWORD ctrlId;           // 컨트롤 ID
    
    // ctrlId 구성
    // char[0]: 식별 문자 1
    // char[1]: 식별 문자 2
    // char[2]: 식별 문자 3
    // char[3]: 식별 문자 4
}
```

### 주요 컨트롤 ID
| ID | 문자열 | 설명 |
|----|--------|------|
| 0x6C626174 | "tabl" | 표 |
| 0x00636573 | "sec " | 구역 |
| 0x6E6C6F63 | "coln" | 단 |
| 0x676E6165 | "eang" | 수식 |
| 0x63697067 | "gpic" | 그림 |
| 0x656C6F67 | "gole" | OLE |
| 0x6E696C67 | "glin" | 선 |
| 0x63657267 | "grec" | 사각형 |
| 0x6C6C6567 | "gell" | 타원 |
| 0x63726167 | "garc" | 호 |
| 0x6C6F7067 | "gpol" | 다각형 |
| 0x76756367 | "gcuv" | 곡선 |
| 0x746E6F67 | "gont" | 묶음 개체 |
| 0x646E6568 | "hend" | 머리말/꼬리말 |
| 0x65746E66 | "fnte" | 각주/미주 |
| 0x6E676170 | "pagn" | 쪽 번호 |
| 0x6B6D6462 | "bdmk" | 책갈피 |
| 0x74786462 | "bdxt" | 덧말/글상자 |

## 표 컨트롤 (Table)

표는 다음과 같은 구조를 가집니다:

```
HWPTAG_CTRL_HEADER (ctrlId = "tabl")
├─ HWPTAG_TABLE
├─ HWPTAG_LIST_HEADER (각 셀마다)
│  ├─ HWPTAG_PARA_HEADER
│  ├─ HWPTAG_PARA_TEXT
│  └─ ...
└─ ...
```

### HWPTAG_TABLE (0x4D)

```
struct Table {
    DWORD property;         // 속성
    WORD rowCount;          // 행 개수
    WORD colCount;          // 열 개수
    HWPUNIT cellSpacing;    // 셀 간격
    HWPUNIT leftMargin;     // 왼쪽 여백
    HWPUNIT rightMargin;    // 오른쪽 여백
    HWPUNIT topMargin;      // 위쪽 여백
    HWPUNIT bottomMargin;   // 아래쪽 여백
    
    // 행 정보
    HWPUNIT rowSizes[rowCount];  // 행 높이
    
    // 테두리 정보
    WORD borderFillId;      // 테두리/배경 ID
    
    // 영역 정보
    WORD zoneInfoCount;     // 영역 정보 개수
    struct ZoneInfo {
        WORD startCol;      // 시작 열
        WORD startRow;      // 시작 행
        WORD endCol;        // 끝 열
        WORD endRow;        // 끝 행
        WORD borderFillId;  // 테두리/배경 ID
    } zoneInfos[zoneInfoCount];
}
```

## 그림 컨트롤 (Picture)

### HWPTAG_SHAPE_COMPONENT_PICTURE (0x55)

```
struct ShapeComponentPicture {
    WORD borderColor;       // 테두리 색
    INT32 borderThickness;  // 테두리 두께
    DWORD borderProperty;   // 테두리 속성
    INT32 leftOffset;       // 왼쪽 오프셋
    INT32 topOffset;        // 위쪽 오프셋
    INT32 rightOffset;      // 오른쪽 오프셋
    INT32 bottomOffset;     // 아래쪽 오프셋
    INT32 cropLeft;         // 자르기 왼쪽
    INT32 cropTop;          // 자르기 위쪽
    INT32 cropRight;        // 자르기 오른쪽
    INT32 cropBottom;       // 자르기 아래쪽
    BYTE brightness;        // 밝기
    BYTE contrast;          // 대비
    BYTE effect;            // 효과
    WORD binDataId;         // 바이너리 데이터 ID
}
```

## 그리기 개체 공통 구조

모든 그리기 개체는 다음 구조를 따릅니다:

```
HWPTAG_CTRL_HEADER
├─ HWPTAG_SHAPE_COMPONENT
│  ├─ 공통 속성
│  └─ 개체별 속성
└─ HWPTAG_SHAPE_COMPONENT_XXX (개체 타입별)
```

### HWPTAG_SHAPE_COMPONENT (0x4C)

```
struct ShapeComponent {
    DWORD ctrlId;           // 컨트롤 ID (개체 타입)
    INT32 xPos;             // X 좌표
    INT32 yPos;             // Y 좌표
    WORD groupLevel;        // 그룹 레벨
    WORD localFileVersion;  // 로컬 파일 버전
    INT32 width;            // 너비
    INT32 height;           // 높이
    WORD property;          // 속성
    INT16 rotateAngle;      // 회전 각도
    INT32 rotateXCenter;    // 회전 중심 X
    INT32 rotateYCenter;    // 회전 중심 Y
    
    // 그래디언트 정보
    struct Gradient {
        BYTE type;          // 그래디언트 타입
        INT32 angle;        // 각도
        INT32 centerX;      // 중심 X
        INT32 centerY;      // 중심 Y
        BYTE step;          // 단계
        COLORREF colors[2]; // 색상
    } gradient;
}
```

## 필드 컨트롤

필드는 동적으로 변경되는 내용을 표시합니다.

### 필드 구조
```
HWPTAG_CTRL_HEADER (ctrlId = 필드 타입별)
├─ 필드 명령
├─ 필드 옵션
└─ 필드 결과 (캐시된 값)
```

### 주요 필드 타입
- 날짜/시간
- 문서 요약
- 페이지 번호
- 참조
- 수식
- 하이퍼링크
- 책갈피

## 주의사항

1. **컨트롤 순서**: 컨트롤은 문서에 나타나는 순서대로 저장
2. **중첩 구조**: 표 안의 표, 글상자 안의 그림 등 중첩 가능
3. **좌표 시스템**: 모든 좌표는 HWPUNIT 단위 사용
4. **ID 참조**: 각종 ID는 DocInfo의 해당 레코드 인덱스