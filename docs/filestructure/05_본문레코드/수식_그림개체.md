# 수식 및 그림 개체

## 수식 개체 (HWPTAG_EQEDIT)

Tag ID: 0x058 | 크기: 가변

### 구조 (표 104)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| BYTE stream | n | 개체 공통 속성 (표 68 참조) |
| BYTE stream | n2 | 수식 개체 속성 (표 105 참조) |
| **전체 길이** | **가변** | **n + n2** |

### 수식 개체 속성 (표 105)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| UINT32 | 4 | 속성<br>bit 0: 켜져 있으면 줄 단위, 꺼져 있으면 글자 단위 |
| WORD | 2 | 스크립트 길이 (len) |
| WCHAR array[len] | 2×len | 글 수식 스크립트 (*) |
| HWPUNIT | 4 | 수식 글자 크기 |
| COLORREF | 4 | 글자 색상 |
| INT16 | 2 | base line |
| WORD | 2 | 수식 버전 정보 길이 (len2) |
| WCHAR array[len2] | 2×len2 | 수식 버전 정보 |
| WORD | 2 | 수식 폰트 이름 길이 (len3) |
| WCHAR array[len3] | 2×len3 | 수식 폰트 이름 |
| **전체 길이** | **가변** | **16 + (2×len) + (2×len2) + (2×len3)** |

> **참고**: 글 수식 스크립트는 EQN 스크립트 호환

## 그림 개체 (HWPTAG_SHAPE_COMPONENT_PICTURE)

Tag ID: 0x055 | 크기: 가변

### 구조 (표 106)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| BYTE stream | n | 개체 공통 속성 (표 68 참조) |
| BYTE stream | n2 | 개체 요소 공통 속성 (표 83 참조) |
| BYTE stream | n3 | 그림 개체 속성 (표 107 참조) |
| **전체 길이** | **가변** | **n + n2 + n3** |

### 그림 개체 속성 (표 107)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| COLORREF | 4 | 테두리 색 |
| INT32 | 4 | 테두리 두께 |
| UINT32 | 4 | 테두리 속성 (표 86 참조) |
| INT32 array[4] | 16 | 이미지의 테두리 사각형의 x 좌표 (최초 그림 삽입 시 크기) |
| INT32 array[4] | 16 | 이미지의 테두리 사각형의 y 좌표 (최초 그림 삽입 시 크기) |
| INT32 | 4 | 자르기 한 후 사각형의 left |
| INT32 | 4 | 자르기 한 후 사각형의 top |
| INT32 | 4 | 자르기 한 후 사각형의 right |
| INT32 | 4 | 자르기 한 후 사각형의 bottom |
| BYTE stream | 8 | 안쪽 여백 정보 (표 72 참조)<br>표(기본값: 141), 그림(기본값: 0) |
| BYTE stream | 5 | 그림 정보 (표 27 참조) |
| BYTE | 1 | 테두리 투명도 |
| UINT32 | 4 | 문서 내 각 개체에 대한 고유 아이디 (instance ID) |
| BYTE stream | n | 그림 효과 정보 |
| **전체 길이** | **가변** | **78 + n** |

### 그림 효과 속성 (표 108)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| UINT32 | 4 | 그림 효과 정보 (그림자, 네온, 부드러운 가장자리, 반사) |
| BYTE stream | n | 각 효과 정보 (표 109 ~ 표 113 참조) |
| **전체 길이** | **가변** | **4 + n** |

### 그림자 효과 속성 (표 109)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| INT32 | 4 | 그림자 스타일 |
| float | 4 | 그림자 투명도 |
| float | 4 | 그림자 흐릿하게 |
| float | 4 | 방향 |
| float | 4 | 거리 |
| INT32 | 4 | 정렬 |
| float | 4 | 기울기 각도(X) |
| float | 4 | 기울기 각도(Y) |
| float | 4 | 확대 비율(X) |
| float | 4 | 확대 비율(Y) |
| INT32 | 4 | 도형과 함께 그림자 회전 |
| BYTE stream | n | 그림자 색상 (표 113 참조) |
| **전체 길이** | **가변** | **44 + n** |

### 네온 효과 속성 (표 110)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| float | 4 | 네온 투명도 |
| float | 4 | 네온 반경 |
| BYTE stream | n | 네온 색상 (표 113 참조) |
| **전체 길이** | **가변** | **8 + n** |

### 부드러운 가장자리 효과 속성 (표 111)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| float | 4 | 부드러운 가장자리 반경 |
| **전체 길이** | **4** | |

### 반사 효과 속성 (표 112)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| INT32 | 4 | 반사 스타일 |
| float | 4 | 반경 |
| float | 4 | 방향 |
| float | 4 | 거리 |
| float | 4 | 기울기 각도(X) |
| float | 4 | 기울기 각도(Y) |
| float | 4 | 확대 비율(X) |
| float | 4 | 확대 비율(Y) |
| INT32 | 4 | 회전 스타일 |
| float | 4 | 시작 투명도 |
| float | 4 | 시작 위치 |
| float | 4 | 끝 투명도 |
| float | 4 | 끝 위치 |
| float | 4 | 오프셋 방향 |
| **전체 길이** | **53** | |

### 색상 속성 (표 113)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| INT32 | 4 | 색상 타입 |
| UINT32 | 4 | RGB (0x00rrggbb) |
| UINT32 | 4 | CMYK (0xccmmyykk) |
| INT32 | 4 | 스키마 타입 |
| INT32 | 4 | 시스템 타입 |
| INT32 | 4 | 프리셋 타입 |
| float | 4 | ScR |
| float | 4 | ScG |
| float | 4 | ScB |
| float | 4 | H |
| float | 4 | S |
| float | 4 | L |
| UINT32 | 4 | 색상 효과 수 |
| BYTE array[n] | 8×n | 색상 효과 (표 114 참조) |
| **전체 길이** | **가변** | **4 + m(4 ~ 12) + n** |

### 색상 효과 속성 (표 114)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| INT32 | 4 | 색상 효과 종류 (표 115 참조) |
| float | 4 | 색상 효과 값 |
| **전체 길이** | **8** | |

### 색상 효과 종류 (표 115)
| 값 | 설명 | 값 | 설명 |
|----|------|-------|------|
| 0 | alpha | 14 | hue_off |
| 1 | alpha_mod | 15 | sat |
| 2 | alpha_off | 16 | sat_mod |
| 3 | red | 17 | sat_off |
| 4 | red_mod | 18 | lum |
| 5 | red_off | 19 | lum_mod |
| 6 | green | 20 | lum_off |
| 7 | green_mod | 21 | shade |
| 8 | green_off | 22 | tint |
| 9 | blue | 23 | gray |
| 10 | blue_mod | 24 | comp |
| 11 | blue_off | 25 | gamma |
| 12 | hue | 26 | inv_gamma |
| 13 | hue_mod | 27 | inv |

### 그림 추가 속성 (표 116)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| HWPUNIT | 8 | 그림 최초 생성 시 기준 이미지 크기 (4×2) |
| INT8 | 1 | 이미지 투명도 |
| **전체 길이** | **9** | |

### 지원 이미지 형식
- **래스터 이미지**: BMP, JPEG, PNG, GIF, TIFF
- **벡터 이미지**: WMF, EMF

### 이미지 저장 방식
1. **임베디드**: BinData 스토리지에 직접 저장
2. **링크**: 외부 파일 경로 참조

## OLE 개체 (HWPTAG_SHAPE_COMPONENT_OLE)

Tag ID: 0x054 | 크기: 가변

### 구조 (표 117)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| BYTE stream | n | 개체 공통 속성 (표 68 참조) |
| BYTE stream | 24 | OLE 개체 속성 (표 118 참조) |
| **전체 길이** | **가변** | **24 + n** |

### OLE 개체 속성 (표 118)
| 자료형 | 길이(바이트) | 설명 |
|--------|------------|------|
| UINT16 | 2 | 속성 (표 119 참조) |
| INT32 | 4 | 오브젝트 자체의 extent x크기 |
| INT32 | 4 | 오브젝트 자체의 extent y크기 |
| UINT16 | 2 | 오브젝트가 사용하는 스토리지의 BinData ID |
| COLORREF | 4 | 테두리 색 |
| INT32 | 4 | 테두리 두께 |
| UINT32 | 4 | 테두리 속성 (표 87 참조) |
| **전체 길이** | **24** | |

### OLE 개체 속성의 속성 (표 119)
| 범위 | 구분 | 값 | 설명 |
|------|-----|----|----- |
| bit 0-7 | | | DVASPECT_CONTENT = 1<br>DVASPECT_THUMBNAIL = 2<br>DVASPECT_ICON = 4<br>DVASPECT_DOCPRINT = 8 |
| bit 8 | | | TRUE if moniker is assigned |
| bit 9-15 | | | 베이스라인. 0은 디폴트(85%)를 뜻하고,<br>1-101이 0-100%를 나타낸다.<br>현재는 수식만이 베이스라인을 별도로 가진다. |
| bit 16-21 | 개체 종류 | 0 | Unknown |
| | | 1 | Embedded |
| | | 2 | Link |
| | | 3 | Static |
| | | 4 | Equation |

> **참고**: 
> - bit 0-7: MSDN의 MFC COleClientItem::m_nDrawAspect 참고
> - bit 8: MSDN의 MFC COleClientItem::m_bMoniker 참고

## 차트 개체

차트는 본문에 OLE 개체로 저장되며, 차트 내용은 OLE Compound 파일로 저장됩니다.

### 차트 저장 방식
차트 파일의 최상위 storage에 저장되는 stream:
- **"Contents"**: 기존 HWP(한글 Neo) 차트 형식
- **"OOXMLChartContents"**: 한글 2018부터 지원하는 OOXML 차트 형식

### 버전별 차이점
- **한글 Neo**: "Contents" stream만 존재
- **한글 2018**: 
  - OOXML 차트를 저장 가능
  - "OOXMLChartContents"와 "Contents" stream 모두 저장
  - "Contents" stream은 구 버전 호환을 위한 변환 데이터

### 차트 형식 참조
- **Contents stream**: 한글문서파일형식_차트_revision1.2_원본.hwp 참조
- **OOXMLChartContents stream**: 
  - MS OOXML 차트 저장 방식 사용
  - 최상위 element: "chartSpace"
  - 상세 스펙: ISO/IEC 29500 또는 ECMA 376의 DrawingML Chart 부분 참조

## 수식 스크립트 형식

### EQN 호환 스크립트
수식은 EQN(Equation) 형식의 텍스트 스크립트로 저장됩니다:
- 수학 기호 및 연산자 지원
- 분수, 제곱근, 적분 등 특수 수식 구조
- 그리스 문자 및 특수 기호

### 예제
```
SQRT{a^2 + b^2}    // 제곱근
{a+b} over {c+d}   // 분수
int from 0 to 1    // 적분
```