# 구조체

한글 문서 파일에서 사용하는 구조체에 대한 설명입니다.

## 구조체 정의

구조체는 여러 자료형을 묶어서 하나의 복합 자료형을 만드는 방법입니다. 한글 문서에서는 다음과 같은 형식으로 구조체를 정의합니다:

```
struct 구조체명 {
    자료형 필드명;
    자료형 필드명;
    ...
}
```

## 구조체 정렬 규칙

### 1. 패킹 (Packing)
- 한글 문서의 구조체는 **1바이트 정렬**을 사용합니다.
- 필드 사이에 패딩이 없습니다.
- C/C++에서는 `#pragma pack(1)` 지시어를 사용합니다.

### 2. 필드 순서
- 구조체의 필드는 정의된 순서대로 저장됩니다.
- 필드 순서를 임의로 변경하면 안 됩니다.

## 주요 구조체 패턴

### 1. 고정 크기 구조체
모든 필드가 고정 크기를 가지는 구조체:

```
struct Point {
    INT32 x;    // 4 바이트
    INT32 y;    // 4 바이트
}               // 총 8 바이트
```

### 2. 가변 크기 구조체
가변 길이 필드를 포함하는 구조체:

```
struct Text {
    WORD length;        // 텍스트 길이
    WCHAR text[length]; // 가변 길이 텍스트
}
```

### 3. 플래그 필드를 가진 구조체
비트 필드를 사용하는 구조체:

```
struct CharShape {
    WORD fontId : 7;        // 폰트 ID (7비트)
    WORD bold : 1;          // 굵게 (1비트)
    WORD italic : 1;        // 기울임 (1비트)
    WORD underline : 3;     // 밑줄 종류 (3비트)
    WORD strikeout : 3;     // 취소선 종류 (3비트)
    WORD outline : 1;       // 외곽선 (1비트)
}
```

## 중첩 구조체

구조체는 다른 구조체를 포함할 수 있습니다:

```
struct Rectangle {
    Point topLeft;      // Point 구조체
    Point bottomRight;  // Point 구조체
}
```

## 구조체 버전 관리

일부 구조체는 버전에 따라 필드가 추가됩니다:

```
struct VersionedStruct {
    WORD size;          // 구조체 크기
    WORD version;       // 버전 정보
    // 기본 필드들...
    
    // version >= 2에서 추가된 필드
    DWORD newField1;
    
    // version >= 3에서 추가된 필드
    DWORD newField2;
}
```

## 구조체 읽기 전략

### 1. 고정 크기 구조체
```c
struct Point point;
fread(&point, sizeof(struct Point), 1, file);
```

### 2. 가변 크기 구조체
```c
// 크기 먼저 읽기
WORD size;
fread(&size, sizeof(WORD), 1, file);

// 동적 메모리 할당
void* data = malloc(size);
fread(data, 1, size, file);
```

### 3. 버전이 있는 구조체
```c
// 크기와 버전 읽기
WORD size, version;
fread(&size, sizeof(WORD), 1, file);
fread(&version, sizeof(WORD), 1, file);

// 버전에 따라 다르게 처리
if (version >= 2) {
    // 새 필드 읽기
}
```

## 주의사항

1. **바이트 순서**: 모든 필드는 리틀 엔디안으로 저장됩니다.
2. **정렬**: 1바이트 정렬을 반드시 지켜야 합니다.
3. **크기 계산**: `sizeof` 연산자 사용 시 패킹 설정을 확인해야 합니다.
4. **호환성**: 구조체 버전을 확인하여 호환성을 유지해야 합니다.