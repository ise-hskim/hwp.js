# 스트림

한글 문서 파일에서 사용되는 주요 스트림에 대한 설명입니다.

## 주요 스트림 목록

### 1. FileHeader 스트림
- **위치**: 루트 스토리지
- **크기**: 256 바이트 (고정)
- **용도**: 파일 식별 및 기본 정보
- **내용**:
  - 파일 시그니처
  - 파일 버전
  - 압축 여부
  - 암호화 정보

### 2. DocInfo 스트림
- **위치**: 루트 스토리지
- **크기**: 가변
- **용도**: 문서 전체에 대한 정보
- **압축**: 일반적으로 압축됨
- **내용**:
  - 문서 속성
  - 스타일 정보
  - 글꼴 정보
  - 문단 모양
  - 글자 모양
  - 탭 정의
  - 번호 형식
  - 글머리 정의

### 3. BodyText/SectionN 스트림
- **위치**: BodyText 스토리지
- **이름**: Section0, Section1, Section2, ...
- **크기**: 가변
- **용도**: 각 구역의 본문 내용
- **압축**: 일반적으로 압축됨
- **내용**:
  - 문단 정보
  - 텍스트 런
  - 컨트롤 객체 (표, 그림, 수식 등)

### 4. PrvText 스트림
- **위치**: 루트 스토리지
- **크기**: 가변
- **용도**: 미리보기용 텍스트
- **압축**: 압축 안 됨
- **인코딩**: UTF-16 LE
- **특징**: 서식 없는 순수 텍스트

### 5. PrvImage 스트림
- **위치**: 루트 스토리지
- **크기**: 가변
- **용도**: 미리보기용 이미지
- **형식**: BMP 또는 PNG
- **용도**: 탐색기 등에서 썸네일 표시

### 6. DocHistory 스트림
- **위치**: 루트 스토리지
- **크기**: 가변
- **용도**: 문서 편집 이력
- **내용**:
  - 버전 정보
  - 수정 내역
  - 작성자 정보

### 7. BinData/BINxxxx.ext 스트림
- **위치**: BinData 스토리지
- **이름**: BIN0001.jpg, BIN0002.png 등
- **크기**: 가변
- **용도**: 포함된 바이너리 데이터
- **형식**: 원본 파일 형식 유지

## 스트림 읽기 과정

### 1. 압축되지 않은 스트림
```
1. 스트림 열기
2. 직접 데이터 읽기
3. 스트림 닫기
```

### 2. 압축된 스트림
```
1. 스트림 열기
2. 전체 데이터 읽기
3. zlib으로 압축 해제
4. 해제된 데이터 처리
5. 스트림 닫기
```

## 스트림 헤더

일부 스트림은 고유한 헤더를 가집니다:

### FileHeader 구조
```
struct FileHeader {
    BYTE signature[32];    // "HWP Document File"
    DWORD version;         // 파일 버전
    DWORD flags;           // 속성 플래그
    BYTE reserved[216];    // 예약 영역
}
```

### 압축 확인
FileHeader의 flags 필드에서 압축 여부 확인:
- bit 0: DocInfo 압축
- bit 1: BodyText 압축
- bit 2: 스크립트 압축

## 스트림 명명 규칙

1. **대소문자**: 구분하지 않음 (대문자 권장)
2. **최대 길이**: 31자 (NULL 제외)
3. **허용 문자**: 영문, 숫자, 일부 특수문자
4. **금지 문자**: /, \, :, !, |

## 커스텀 스트림 추가

새로운 스트림을 추가하여 확장 가능:
```
루트 스토리지
├─ ... (기존 스트림)
└─ MyCustomData (새 스트림)
```

한글은 인식하지 못하는 스트림을 무시하므로 호환성 유지 가능

## 주의사항

1. **순서 의존성**: DocInfo를 먼저 읽어야 BodyText 해석 가능
2. **압축 처리**: 압축 플래그 확인 필수
3. **인코딩**: 텍스트는 주로 UTF-16 LE 사용
4. **크기 제한**: 개별 스트림은 2GB 이하 권장