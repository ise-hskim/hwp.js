# 데이터 레코드

## 개요

논리적으로 연관된 데이터들을 헤더 정보와 함께 저장하는 방식입니다. 레코드 구조를 가지는 스트림은 연속된 여러 개의 레코드로 구성되며, 각 헤더 정보를 활용하여 전체 논리적 구조를 생성합니다.

## 레코드 구조

### 기본 구조
```
레코드
┌─────────────────────┬────────────┐
│     헤더 (DWORD)     │   데이터    │
└─────────────────────┴────────────┘
          ↓
┌────────┬─────────┬──────┐
│Tag ID  │ Level   │ Size │
│ 0~9    │ 10~19   │20~31 │
└────────┴─────────┴──────┘
```

### 헤더 구성 (32 bits)
- **Tag ID** (10 bits): 데이터 종류
- **Level** (10 bits): 계층 구조 depth
- **Size** (12 bits): 데이터 영역 크기

## Tag ID 영역

| 범위 | 용도 |
|------|------|
| **0x000 - 0x00F** | 특별 용도 |
| **0x010 - 0x1FF** | 한글 내부용 (HWPTAG_BEGIN = 0x010) |
| **0x200 - 0x3FF** | 외부 어플리케이션용 |

최대 1024개(0x3FF)의 태그 정의 가능

## Level (계층 구조)

레벨은 논리적으로 연관된 레코드의 묶음을 표현합니다.
- 스트림의 모든 레코드는 계층 구조로 표현 가능
- 레벨 값 = 계층 구조에서의 depth
- 하위 호환성 보장에 중요한 역할

## Size 필드

### 일반 크기 (< 4095 bytes)
- Size 필드에 직접 바이트 크기 저장
- 12 bits로 표현 (0 ~ 4094)

### 확장 크기 (≥ 4095 bytes)
- Size 필드 = 0xFFF (모든 비트가 1)
- 추가 DWORD로 실제 크기 저장

```
확장 데이터 레코드
┌─────────────────────┬─────────────────┬────────────┐
│    헤더 (DWORD)     │   길이 (DWORD)  │   데이터    │
└─────────────────────┴─────────────────┴────────────┘
```

## 하위 호환성

레코드 구조는 하위 호환성을 보장하도록 설계되었습니다:
- 헤더의 Size 정보로 인식하지 못하는 레코드 건너뛰기 가능
- Level 정보로 논리적 구조 파악 가능
- 새로운 기능 추가 시 기존 버전도 문서 읽기 가능