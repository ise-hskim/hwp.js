# 본문 레코드 (BodyText)

## 개요

본문은 `BodyText/SectionN` 스트림에 구역별로 저장됩니다. 문단 단위로 레코드가 이어지며, 텍스트와 컨트롤(개체/필드 등)이 혼재합니다.

> 범례/출처: Tag ID 표기는 `05-appendix/tag-id-reference.md`, 컨트롤 ID/문단 리스트 범례는 `05-appendix/control-id-reference.md`를 참고하세요.

## 문단 관련 기본 레코드

| Tag ID                   | 이름           | 설명                                        |
| ------------------------ | -------------- | ------------------------------------------- |
| `HWPTAG_PARA_HEADER`     | 문단 헤더      | 문단의 기본 속성/길이 정보(표 58)           |
| `HWPTAG_PARA_TEXT`       | 문단 텍스트    | UTF-16LE 텍스트와 인라인 컨트롤 코드(표 60) |
| `HWPTAG_PARA_CHAR_SHAPE` | 문단 글자 모양 | 텍스트 구간별 글자모양(런) 범위(표 61)      |
| `HWPTAG_PARA_LINE_SEG`   | 문단 줄 나눔   | 조판 결과 줄 분할 정보(표 62)               |
| `HWPTAG_PARA_RANGE_TAG`  | 문단 범위 태그 | 책갈피/하이퍼링크 등 범위 표식(표 63)       |
| `HWPTAG_LIST_HEADER`     | 리스트 헤더    | 목록 문단 관련 헤더(필요 시, 표 65)         |

> 페이지/각주/쪽 테두리 등 구역/페이지 레코드는 컨트롤 항목을 참고하세요.

> 참고: 컨트롤 진입 시 `HWPTAG_CTRL_HEADER`(표 64) 이후 컨트롤별 레코드가 이어집니다.

---

## HWPTAG_PARA_HEADER (문단 헤더)

문단의 전반 정보.

- 문단 모양 ID, 스타일 ID
- 문단 길이(문자 수), 인라인 컨트롤 수
- 문단 번호/목록 상태

## HWPTAG_PARA_TEXT (문단 텍스트)

- 인코딩: UTF-16LE
- 인라인 컨트롤 코드 포함(필드, 개체 자리표시 등)
- 확장 영역: 끊김/개행/탭 코드 포함

## HWPTAG_PARA_CHAR_SHAPE (문단 글자 모양)

텍스트 구간별(오프셋/길이)로 글자 모양 ID를 매핑합니다.

- 항목: `(pos, count, charShapeId)`
- 문단 범위 밖을 참조하지 않도록 유효성 검사 필요

## HWPTAG_PARA_LINE_SEG (문단 줄 나눔)

조판 결과를 보조하는 라인 세그먼트 묶음입니다.

- 줄 시작 오프셋, 길이
- 베이스라인, 행간 계수, 들여쓰기 반영

## HWPTAG_PARA_RANGE_TAG (문단 범위 태그)

책갈피, 하이퍼링크, 교차참조 등 범위 기반 메타를 저장합니다.

- 시작/끝 위치
- 태그 종류/속성

---

## 컨트롤(Controls)

컨트롤은 `HWPTAG_CTRL_HEADER`로 시작하며, 컨트롤 ID(`MAKE_4CHID`)로 종류를 식별합니다. 컨트롤 내부에는 해당 컨트롤에 특화된 하위 레코드가 이어집니다.

| 범주        | 컨트롤 ID 예시                                  | 설명                                         |
| ----------- | ----------------------------------------------- | -------------------------------------------- |
| 문서 구조   | `'secd' 'cold' 'head' 'foot'`                   | 구역/단/머리말/꼬리말(문단 리스트 포함 가능) |
| 주석        | `'fn  ' 'en  '`                                 | 각주/미주(문단 리스트 포함)                  |
| 번호/페이지 | `'atno' 'nwno' 'pgnp' 'pgct'`                   | 자동번호, 새 번호, 쪽 번호, 홀짝 조정        |
| 참조        | `'idxm' 'bokm'`                                 | 찾아보기 표식, 책갈피                        |
| 텍스트 효과 | `'tcps' 'tdut' 'tcmt'`                          | 글자 겹침/덧말/숨은 설명                     |
| 필드        | `'%dte' '%hlk' ...`                             | 날짜/하이퍼링크 등 필드 시작                 |
| 개체        | `'$pic' '$ole' '$tbl' '$equ' '$txt' '$vid' ...` | 그림/OLE/표/수식/글맵시/동영상 등            |

> 전체 컨트롤 ID 목록은 `05-appendix/control-id-reference.md`(표 127/128) 를 참고하세요.

### 페이지/구역 관련 컨트롤 (발췌)

- `HWPTAG_PAGE_DEF` (용지 설정) — 폭/높이, 여백, 제책/방향 등(표 131~132)
- `HWPTAG_FOOTNOTE_SHAPE` (각주 모양)(표 133~134)
- `HWPTAG_PAGE_BORDER_FILL` (쪽 테두리/배경)(표 135~136)

### 개체 공통/그림/그래픽 효과 (발췌)

- 개체 공통 속성(위치, 크기, 회전, 여백, 줄배치 등)(표 67)
- 그림 추가 속성: 기준 이미지 크기, 투명도(표 108)
- 색상/효과: 그림자/네온/부드러운 가장자리/반사 등(표 109~112)

### OLE / 차트 / 묶음 / 동영상 (발췌)

- OLE: 개체 속성(속성 비트, extent, BinData ID, 테두리 등)
- 차트: OLE Compound `Contents` / `OOXMLChartContents`
- 묶음: 컨트롤 ID 배열(포함 개체 집합)
- 동영상: 타입(로컬/웹) 및 속성(BinData ID/웹 태그 등), 데이터 레코드 `HWPTAG_VIDEO_DATA`(+82)

---

## 파싱 순서 제안

1. `DocInfo` 선 파싱(참조 테이블 준비)
2. `SectionN` 스트림 순회
3. 문단 헤더/텍스트/런/라인 처리
4. 컨트롤 진입 시 `HWPTAG_CTRL_HEADER`(표 64) 이후 하위 레코드 파싱
5. Level/Size로 중첩 구조 관리

## 호환성/에러 처리

- 미지 컨트롤/레코드는 Size만큼 건너뛰어 보존
- 잘못된 범위(오프셋/길이)는 안전하게 클램핑
- 대용량 본문은 스트리밍 처리 권장

## 관련 표 (원문)

- 표 57: 본문의 데이터 레코드 요약
- 표 58~66: 문단 헤더/텍스트/글자 모양/레이아웃/영역 태그/컨트롤/문단 리스트 헤더/컨트롤 임의 데이터
- 표 67: 개체 공통 속성을 포함하는 컨트롤과 컨트롤ID
- 표 74~116: 표/개체/그림/그림 효과/그림 추가/OLE 등 개체 세부 표
- 표 117~126: OLE/묶음/동영상 등 개체 세부 표
- 표 127~128: 개체 이외의 컨트롤/필드 컨트롤 ID
- 표 130~148: 구역/용지/각주/쪽/단/머리말/꼬리말/번호 등 구조 컨트롤 관련 표
- 표 149~153: 찾아보기/필드 관련 표

## 개체 공통 속성 적용 범위 (요약)

| 속성 범주                 | 적용 개체                     | 출처         |
| ------------------------- | ----------------------------- | ------------ |
| 개체 공통 속성(표 68~70)  | 선/사각형/타원/호/다각형/곡선 | 표 81~102 등 |
| 캡션(표 71~73)            | 표/개체 전반(필요 시)         | 표 71~73     |
| 테두리/채우기/매트릭스 등 | 그리기 개체 전반              | 표 84~87     |
